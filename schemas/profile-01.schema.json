{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "cluster",
    "description": "Bilbo schema for cluster",
    "definitions": {
        "instanceType": {
            "description": "Instance type config",
            "additionalProperties": false,
            "properties": {
                "ami": {
                    "type": "string",
                    "description": "AWS machine image ID",
                    "pattern": "^ami-[0-9a-f]+$"
                },
                "ec2type": {
                    "type": "string",
                    "description": "EC2 Instance type"
                },
                "keyname": {
                    "type": "string",
                    "description": "The instance's EC2 Key-pair name"
                },
                "security_group": {
                    "type": "string",
                    "description": "Security group id for instance",
                    "pattern": "^sg-[0-9a-f]+$"
                },
                "ssh_user": {
                    "type": "string",
                    "description": "User for SSH login"
                },
                "ssh_private_key": {
                    "type": "string",
                    "description": "Private key for SSH login"
                },
                "tags": {
                    "type": "array",
                    "description": "Instance tag list",

                    "items": {
                        "type": "array",
                        "description": "Tag item",
                        "minItems": 2,
                        "maxItems": 2,
                        "items": {
                            "type": "string"
                        }
                    }
                }
            }
        },
        "daskType": {
            "description": "Dask cluster config",
            "additionalProperties": false,
            "properties": {
                "type": {
                    "const": "dask"
                },
                "scheduler": {
                    "additionalProperties": false,
                    "properties": {
                        "instance": {
                            "$ref": "#/definitions/instanceType"
                    }
                    }
                },
                "worker": {
                    "additionalProperties": false,
                    "properties": {
                        "instance": {
                            "$ref": "#/definitions/instanceType"
                        },
                        "count": {
                            "type": "integer",
                            "description": "Dask worker instance count",
                            "minimum": 1
                        }
                    }
                }
            },
            "required": ["type"]
        },
        "rayType": {
            "description": "Ray cluster config",
            "additionalProperties": false,
            "properties": {
                "type": {
                    "const": "ray"
                }
            },
            "required": ["type"]
        }
    },
    "additionalProperties": false,
    "properties": {
        "$schema": {
            "type": "string",
            "description": "Schema URI"
        },
        "instance": {
            "description": "Instance configuration",
            "$ref": "#/definitions/instanceType"
        },
        "cluster": {
            "oneOf": [
                { "$ref": "#/definitions/daskType"},
                { "$ref": "#/definitions/rayType"}
                ]
        }
    },
    "required": ["cluster"]
}